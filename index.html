<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>H·ªçc Ti·∫øng Anh Vui Nh·ªôn</title>
  <style>
    body {
      font-family: 'Comic Sans MS', sans-serif;
      background: linear-gradient(to right, #f9d423, #ff4e50);
      margin: 0;
      padding: 20px;
      text-align: center;
      color: #333;
    }

    h1 {
      font-size: 36px;
      color: white;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      margin-bottom: 10px;
    }

    #score {
      font-size: 22px;
      font-weight: bold;
      background: white;
      display: inline-block;
      padding: 8px 15px;
      border-radius: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }

    #filter {
      background: white;
      padding: 15px;
      border-radius: 15px;
      display: inline-block;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    label {
      font-weight: bold;
    }

    select,
    #filter button {
      padding: 10px;
      margin: 5px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }

    #filter button {
      background: #27ae60;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    #filter button:hover {
      background: #219150;
    }

    #quiz {
      margin-top: 20px;
    }

    img {
      max-width: 250px;
      max-height: 250px;
      border: 5px solid #fff;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      margin: 15px auto;
    }

    .word {
      font-size: 26px;
      font-weight: bold;
      color: #fff;
      margin: 10px 0;
    }

    #audioBtn {
      font-size: 40px;
      cursor: pointer;
      margin: 10px;
      color: white;
      text-shadow: 0 0 5px black;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-width: 420px;
      margin: 20px auto;
    }

    button.option {
      padding: 15px;
      border: none;
      border-radius: 15px;
      background: #3498db;
      color: white;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button.option:hover {
      background: #2980b9;
      transform: scale(1.05);
    }

    #nextBtn {
      margin-top: 15px;
      padding: 12px 25px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background: #f39c12;
      color: white;
      font-weight: bold;
      transition: transform 0.2s;
    }

    #nextBtn:hover {
      background: #d35400;
      transform: scale(1.05);
    }

    .menuBtn {
      margin: 10px;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      background: #9b59b6;
      color: white;
      transition: 0.2s;
    }

    .menuBtn:hover {
      opacity: 0.85;
      transform: scale(1.05);
    }

    form,
    #listContainer {
      display: none;
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }

    form input,
    form select {
      margin: 8px 0;
      padding: 10px;
      width: 95%;
      border: 1px solid #ccc;
      border-radius: 10px;
    }

    form button {
      margin-top: 10px;
      padding: 10px 15px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #list .item {
      background: #ecf0f1;
      margin: 8px 0;
      padding: 12px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .item span {
      font-weight: bold;
      color: #2c3e50;
    }

    .deleteBtn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .deleteBtn:hover {
      background: #c0392b;
    }

    /* Th√¥ng b√°o n·ªïi (toast) */
    #toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 1000;
      left: 50%;
      top: 30px;
      font-size: 25px;
      opacity: 0;
      transition: opacity 0.5s, top 0.5s;
    }

    #toast.show {
      visibility: visible;
      opacity: 1;
      top: 50px;
    }

    #toast.success {
      background: #27ae60;
    }

    #toast.error {
      background: #e74c3c;
    }
  </style>
</head>

<body>
  <h1>üêº H·ªçc Ti·∫øng Anh Vui Nh·ªôn ü¶ä</h1>
  <div id="score">ƒêi·ªÉm: 0</div>

  <!-- B·ªô l·ªçc -->
  <div id="filter">
    <label>Nh√≥m:</label>
    <select id="groupSelect"></select>
    <label>C·∫•p ƒë·ªô:</label>
    <select id="levelSelect"></select>
    <label>Lesson:</label>
    <select id="lessonSelect"></select>
    <button onclick="startQuiz()">B·∫Øt ƒë·∫ßu</button>
  </div>

  <!-- Quiz -->
  <div id="quiz">
    <img id="image" src="" alt="H√¨nh ·∫£nh">
    <div class="word" id="word"></div>
    <div id="audioBtn" title="Ph√°t √¢m thanh"></div>
    <div class="options" id="options"></div>
    <button id="nextBtn">üëâ C√¢u ti·∫øp theo</button>
  </div>

  <!-- N√∫t menu -->
  <div>
    <button class="menuBtn" onclick="toggleForm()">‚ûï Th√™m t·ª´</button>
    <button class="menuBtn" onclick="toggleList()">üìã Danh s√°ch t·ª´ v·ª±ng</button>
  </div>

  <!-- Form th√™m -->
  <form id="addForm">
    <h3>‚ûï Th√™m c√¢u h·ªèi</h3>
    <select id="addGroup"></select>
    <select id="addLevel"></select>
    <select id="addLesson"></select><br>
    <input type="url" id="imageUrl" placeholder="Link ·∫£nh online" required><br>
    <input type="url" id="audioUrl" placeholder="Link audio (t√πy ch·ªçn)"><br>
    <input type="text" id="correct" placeholder="ƒê√°p √°n ƒë√∫ng" required><br>
    <input type="text" id="wrong1" placeholder="ƒê√°p √°n sai 1" required><br>
    <input type="text" id="wrong2" placeholder="ƒê√°p √°n sai 2" required><br>
    <input type="text" id="wrong3" placeholder="ƒê√°p √°n sai 3" required><br>
    <button type="submit">üíæ L∆∞u</button>
  </form>

  <!-- Danh s√°ch t·ª´ v·ª±ng -->
  <div id="listContainer">
    <h3>üìñ Danh s√°ch t·ª´ v·ª±ng</h3>
    <div id="list"></div>
  </div>

  <script>
    // Sinh Lesson 1-60
    function generateLessons() {
      let lessons = [];
      for (let i = 1; i <= 60; i++) lessons.push("Lesson " + i);
      return lessons;
    }

    // C·∫•u tr√∫c d·ªØ li·ªáu levels
    const levels = {
      Cambridge: {
        Starter: generateLessons(),
        Mover: generateLessons(),
        Flyer: generateLessons(),
        KET: generateLessons(),
        PET: generateLessons(),
        FCE: generateLessons()
      },
      School: {
        "L·ªõp 1": generateLessons(),
        "L·ªõp 2": generateLessons(),
        "L·ªõp 3": generateLessons(),
        "L·ªõp 4": generateLessons(),
        "L·ªõp 5": generateLessons(),
        "L·ªõp 6": generateLessons(),
        "L·ªõp 7": generateLessons()
      }
    };

    let savedQ = localStorage.getItem("questions");
    let questions = savedQ ? JSON.parse(savedQ) : [
      {
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3a/Cat03.jpg",
        correct: "Cat",
        wrong: ["Dog", "Bird", "Fish"],
        audio: "https://dictionary.cambridge.org/media/english/uk_pron/u/ukc/ukcaz/ukcazzz021.mp3",
        group: "Cambridge",
        level: "Starter",
        lesson: "Lesson 1"
      }
    ];
    let score = 0;

    const image = document.getElementById("image");
    const wordDiv = document.getElementById("word");
    const optionsDiv = document.getElementById("options");
    const scoreDiv = document.getElementById("score");
    const audioBtn = document.getElementById("audioBtn");
    const groupSelect = document.getElementById("groupSelect");
    const levelSelect = document.getElementById("levelSelect");
    const lessonSelect = document.getElementById("lessonSelect");
    const addGroup = document.getElementById("addGroup");
    const addLevel = document.getElementById("addLevel");
    const addLesson = document.getElementById("addLesson");
    const listDiv = document.getElementById("list");

    // ƒêi·ªÅn Group -> Level -> Lesson
    function fillSelects() {
      [groupSelect, addGroup].forEach(sel => {
        sel.innerHTML = "";
        Object.keys(levels).forEach(gr => {
          let opt = document.createElement("option");
          opt.value = gr;
          opt.textContent = gr;
          sel.appendChild(opt);
        });
      });
      updateLevelSelect(groupSelect, levelSelect, lessonSelect);
      updateLevelSelect(addGroup, addLevel, addLesson);
    }

    function updateLevelSelect(groupEl, levelEl, lessonEl) {
      levelEl.innerHTML = "";
      Object.keys(levels[groupEl.value]).forEach(lv => {
        let opt = document.createElement("option");
        opt.value = lv;
        opt.textContent = lv;
        levelEl.appendChild(opt);
      });
      updateLessonSelect(groupEl.value, levelEl.value, lessonEl);
    }

    function updateLessonSelect(group, level, lessonEl) {
      lessonEl.innerHTML = "";
      levels[group][level].forEach(ls => {
        let opt = document.createElement("option");
        opt.value = ls;
        opt.textContent = ls;
        lessonEl.appendChild(opt);
      });
    }

    groupSelect.onchange = () => updateLevelSelect(groupSelect, levelSelect, lessonSelect);
    addGroup.onchange = () => updateLevelSelect(addGroup, addLevel, addLesson);
    levelSelect.onchange = () => updateLessonSelect(groupSelect.value, levelSelect.value, lessonSelect);
    addLevel.onchange = () => updateLessonSelect(addGroup.value, addLevel.value, addLesson);

    function saveQuestions() { localStorage.setItem("questions", JSON.stringify(questions)); renderList(); }

    function startQuiz() {
      score = 0;
      scoreDiv.textContent = "ƒêi·ªÉm: " + score;
      loadRandomQuestion();
    }

    function loadRandomQuestion() {
      let group = groupSelect.value, level = levelSelect.value, lesson = lessonSelect.value;
      let filtered = questions.filter(q => q.group === group && q.level === level && q.lesson === lesson);
      if (!filtered.length) { optionsDiv.innerHTML = "‚ùå Ch∆∞a c√≥ c√¢u h·ªèi!"; return; }
      let q = filtered[Math.floor(Math.random() * filtered.length)];
      image.src = q.img;
      wordDiv.textContent = q.correct;
      audioBtn.innerHTML = q.audio ? "üîä" : "";
      if (q.audio) audioBtn.onclick = () => new Audio(q.audio).play();

      let opts = [...q.wrong, q.correct].sort(() => Math.random() - 0.5);
      const labels = ["A", "B", "C", "D"];
      optionsDiv.innerHTML = "";
      opts.forEach((opt, idx) => {
        let b = document.createElement("button");
        b.className = "option";
        b.textContent = labels[idx] + ". " + opt;
        b.onclick = () => {
          if (opt === q.correct) {
            score += 10;
            showToast("üéâ Ch√≠nh x√°c! +10 ƒëi·ªÉm", "success");
          } else {
            score = Math.max(0, score - 5);
            showToast("üò¢ Sai r·ªìi! -5 ƒëi·ªÉm", "error");
          }
          scoreDiv.textContent = "ƒêi·ªÉm: " + score;
        };
        optionsDiv.appendChild(b);
      });
    }
    document.getElementById("nextBtn").onclick = loadRandomQuestion;

    document.getElementById("addForm").onsubmit = e => {
      e.preventDefault();
      let newQ = {
        img: document.getElementById("imageUrl").value,
        audio: document.getElementById("audioUrl").value,
        correct: document.getElementById("correct").value,
        wrong: [wrong1.value, wrong2.value, wrong3.value],
        group: addGroup.value,
        level: addLevel.value,
        lesson: addLesson.value
      };
      questions.push(newQ);
      saveQuestions();
      e.target.reset();
      toggleForm(false);
    };

    function renderList() {
      listDiv.innerHTML = "";
      questions.forEach((q, i) => {
        let d = document.createElement("div");
        d.className = "item";
        d.innerHTML = `<span>[${q.group}-${q.level}-${q.lesson}] ${q.correct}</span>
          <div><button class="deleteBtn" onclick="deleteQuestion(${i})">X√≥a</button></div>`;
        listDiv.appendChild(d);
      });
    }
    function deleteQuestion(i) { if (confirm("X√≥a t·ª´ n√†y?")) { questions.splice(i, 1); saveQuestions(); } }

    function toggleForm(force) {
      document.getElementById("addForm").style.display =
        force === false ? "none" : (document.getElementById("addForm").style.display === "block" ? "none" : "block");
      document.getElementById("listContainer").style.display = "none";
    }
    function toggleList(force) {
      document.getElementById("listContainer").style.display =
        force === false ? "none" : (document.getElementById("listContainer").style.display === "block" ? "none" : "block");
      document.getElementById("addForm").style.display = "none";
    }

    function showToast(message, type = "success") {
      let toast = document.getElementById("toast");
      toast.className = "show " + type;
      toast.textContent = message;
      setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2000);
    }

    fillSelects();
    renderList();
  </script>
  <div id="toast"></div>
</body>
</html>
